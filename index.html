<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/icon-512.svg" />
    <link rel="apple-touch-icon" href="/icon-192.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="color-scheme" content="dark light" />
    <!-- Adaptive theme-color to avoid bright flash on load -->
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0b1220" />
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f6f7fb" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>InterectNote - 무한 캔버스 메모</title>
    <!-- Early theme bootstrap to prevent light flash -->
    <script>
      (function() {
        try {
          var saved = localStorage.getItem('interectnote-theme');
          var isDark = saved ? (saved === 'dark') : window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (isDark) {
            document.documentElement.classList.add('dark');
            document.documentElement.style.backgroundColor = '#0b1220';
          } else {
            document.documentElement.classList.remove('dark');
            document.documentElement.style.backgroundColor = '#f6f7fb';
          }
        } catch (e) { /* no-op */ }
      })();
    </script>
    <style>
      #boot-fallback {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 24px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
          'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        opacity: 0;
        transition: opacity 0.2s ease;
      }
      #boot-fallback .title {
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 8px;
        color: #0f172a;
      }
      #boot-fallback .desc {
        font-size: 13px;
        line-height: 1.5;
        margin-bottom: 12px;
        color: #334155;
      }
      #boot-fallback button {
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid rgba(15, 23, 42, 0.15);
        background: rgba(255, 255, 255, 0.7);
        color: #0f172a;
        font-size: 14px;
        cursor: pointer;
      }
      #boot-fallback .hint {
        margin-top: 12px;
        font-size: 12px;
        line-height: 1.4;
        color: #475569;
      }
      html.dark #boot-fallback .title {
        color: #e2e8f0;
      }
      html.dark #boot-fallback .desc {
        color: #94a3b8;
      }
      html.dark #boot-fallback button {
        border-color: rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.35);
        color: #e2e8f0;
      }
      html.dark #boot-fallback .hint {
        color: rgba(148, 163, 184, 0.9);
      }
      #boot-fallback .actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }
    </style>
  </head>
  <body>
    <div id="root">
      <div id="boot-fallback">
        <div style="text-align: center; max-width: 360px;">
          <div class="title">로딩 중…</div>
          <div class="desc">검은 화면이 계속되면 새로고침을 한 번 해보세요.</div>
          <div class="actions">
            <button type="button" onclick="location.reload()">새로고침</button>
            <button type="button" onclick="window.__resetInterectnoteCache?.()">캐시 초기화</button>
          </div>
          <div class="hint">iPhone PWA에서 계속 안 열리면: 앱 삭제 → Safari에서 다시 “홈 화면에 추가”.</div>
        </div>
      </div>
    </div>
    <script>
      (function() {
        window.__resetInterectnoteCache = async function() {
          try {
            if ('serviceWorker' in navigator) {
              const regs = await navigator.serviceWorker.getRegistrations();
              await Promise.all(regs.map(function(r) { return r.unregister(); }));
            }
          } catch (e) { /* no-op */ }

          try {
            if ('caches' in window) {
              const keys = await caches.keys();
              await Promise.all(keys.map(function(k) { return caches.delete(k); }));
            }
          } catch (e) { /* no-op */ }

          try {
            location.reload();
          } catch (e) {
            location.href = location.href;
          }
        };

        setTimeout(function() {
          var el = document.getElementById('boot-fallback');
          if (el) el.style.opacity = '1';
        }, 1200);
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
